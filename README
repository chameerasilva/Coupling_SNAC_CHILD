Coupling_SNAC_CHILD
===================

1. Building without Pythia

1.1 set environments
For example, in bash,

export SNAC_DIR=${HOME}/projects/Coupling_SNAC_CHILD/SNAC_CHILD/build-optimised
export SNAC_BINDIR=${SNAC_DIR}/bin
export SNAC_INCDIR=${SNAC_DIR}/include
export SNAC_LIBDIR=${SNAC_DIR}/lib
export SNAC_MODDIR=${SNAC_DIR}/Python
export PATH=${SNAC_BINDIR}:${PATH}
export DYLD_LIBRARY_PATH=$SNAC_LIBDIR:${DYLD_LIBRARY_PATH}
export PYTHONPATH=${SNAC_MODDIR}:${PYTHONPATH}

1.2 build child

cd child/bin
make -f child_so.mk

Note that a correct build type and compiler should be specified in child_so.mk, which are collected in separage make files such as gcc.mk, gcc_shared.mk, gccmac.mk, and gccmac_shared.mk.

1.3 build childInterface

cd childInterface
make

1.4 build SNAC

cd SNAC_CHILD
./configure --options=optimised
make

1.5 Test

cd models
cd SnacTest1
Snac ./testsnac.xml

1.6 Post-process results
In models/SnacTest1,
SNAC:

snac2vtk ./newdata 1 10000000000

CHILD:

../child/Viz/child2vtk
(give your child output prefix when prompted, 
which is specified in the input file for CHILD. testchild.in, for instance.)

1.7 Visualize results

Both codes produce (p)vtk files. One can use VisIt or ParaView to visualize them.


2. Build SNAC with Pythia

2.1 Install dependencies
2.1.1 merlin-1.8
- Download .egg file from https://pypi.python.org/pypi/merlin
- sudo easy_install merlin-1.8.egg

2.1.2 pythia-0.8
- https://geodynamics.org/cig/software/pythia/
- Fix Makefile.am
ACLOCAL_AMFLAGS = -I ./m4 ==> ACLOCAL_AMFLAGS = -I m4
- Reconfigure
autoreconf -i .
- Set up environment variables
export CXX=g++-mp-4.8
export CC=gcc-mp-4.8
export MPI_DIR=/Users/eunseo/opt/openmpi-1.8
export MPI_BINDIR=${MPI_DIR}/bin
export MPI_LIBDIR=${MPI_DIR}/lib
export MPI_INCDIR=${MPI_DIR}/include
export MPI_RUN=${MPI_BINDIR}/mpirun
export PATH=${MPI_BINDIR}:${PATH}
export LD_LIBRARY_PATH=${MPI_LIBDIR}:${LD_LIBRARY_PATH}
- Run ./configure
MPIINCLUDES=-I/Users/eunseo/opt/openmpi-1.8/include ./configure --prefix=/Users/eunseo/projects/snac_bmi/pythia
- make; make install

2.1.3 Exchanger-1.0.1
- https://geodynamics.org/cig/software/exchanger/
- Contains classes to be inherited by StGermain and Snac's Exchanger module.
- It tries to install pythia-0.8.
/anaconda/bin/python setup.py install_deps -f /Users/eunseo/projects/Coupling_SNAC_CHILD/snac_bmi/Exchanger-1.0.1/deps -zmxd /Users/eunseo/projects/Coupling_SNAC_CHILD/snac_bmi/Exchanger-1.0.1/deps; 
/anaconda/bin/python setup.py develop -H None -f /Users/eunseo/projects/Coupling_SNAC_CHILD/snac_bmi/Exchanger-1.0.1/deps -x -d /Users/eunseo/projects/Coupling_SNAC_CHILD/snac_bmi/Exchanger-1.0.1/python; 
/anaconda/bin/python setup.py egg_flags (<-- Not working!!)
- configure
CC=/Users/eunseo/opt/openmpi-1.6.1/bin/mpicc CXX=/Users/eunseo/opt/openmpi-1.6.1/bin/mpicxx PYTHON=/anaconda/bin/python CXXFLAGS="-I${PYTHIA_INCDIR} -I${MPI_INCDIR}" LDFLAGS="-L${MPI_LIBDIR}" ./configure --prefix=/Users/eunseo/projects/Coupling_SNAC_CHILD/snac_bmi/Exchanger
- make; make install (Note: the local sysconfig.pyc can confuse the install process).

2.1.4 SNAC
- Set up environment
export PYTHON_DIR=/anaconda
export PYTHON_VERSION=2.7
export PYTHIA_DIR=${HOME}/projects/Coupling_SNAC_CHILD/snac_bmi/pythia
export PYTHIA_INCDIR=${PYTHIA_DIR}/include/pythia-0.8
export PYTHIA_LIBDIR=${PYTHIA_DIR}/lib
export PYTHIA_BINDIR=${PYTHIA_DIR}/bin
export PATH=${PYTHIA_BINDIR}:${PATH}
export PYTHONPATH=${PYTHIA_LIBDIR}/python2.7/site-packages:${PYTHONPATH}

export EXCHANGER_DIR=${HOME}/projects/Coupling_SNAC_CHILD/snac_bmi/Exchanger
export EXCHANGER_INCDIR=${EXCHANGER_DIR}/include
export EXCHANGER_LIBDIR=${EXCHANGER_DIR}/lib
export EXCHANGER_BINDIR=${EXCHANGER_DIR}/bin
export PATH=${PYTHIA_BINDIR}:${PATH}
export LD_LIBRARY_PATH=${PYTHIA_LIBDIR}:${LD_LIBRARY_PATH}
export PYTHONPATH=${PYTHIA_LIBDIR}/python2.7/site-packages:${PYTHONPATH}


